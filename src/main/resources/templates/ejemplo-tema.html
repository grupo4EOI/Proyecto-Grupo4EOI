<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${comentarios.get(0).publicacion().titulo()}">Título de ejemplo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/style-ejemplo-tema.css}">
</head>

    <!--Contenido de la página-->
<body>
<div layout:fragment="content">
    <!--Banner título del tema-->
    <div class="bg-custom mt-4 mx-auto p-3 w-75" style="border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
        <h2 th:text="${comentarios.get(0).publicacion().titulo()}">Título de ejemplo</h2>
    </div>

    <!--Mensaje del creador del tema-->
    <div class="bg-custom text-light mx-auto ps-3 w-75 p-2 mt-2" th:each="comentario, stat : ${comentarios}">
      <!--Este div contiene la información del mensaje-->
      <div class="d-flex justify-content-between align-items-center">
        <!--Imagen de perfil-->
      <div class="border-right border-dark me-3">
        <img class="avatar" th:src="${comentario.usuario().avatarUrl()}">
      </div>
      <!--Usuario y rol-->
      <div class="ms-3">
        <a class="nav-link" href="#"><h6 class="mb-1" th:text="${comentario.usuario().nombreUsuario()}">Usuario1</h6></a>
        <p class="mb-0" style="font-size: 14px;" th:text="'Rol: ' + ${comentario.usuario().role()}">Reseñas.com: Usuario</p>
      </div>
      <!--Fecha y número de mensaje-->
      <div class="ms-auto me-3 align-items-center d-flex flex-column justify-content-center text-end">
        <p class="mb-0" th:text="${#temporals.format(comentario.fecha(), 'dd-MM-yyyy HH:mm')}">Hoy XX:XX</p>
        <p class="mb-0">#<span th:text="${stat.count}"></span></p>
      </div>
    </div>
    <!--Línea de separación-->
  <hr class="w-75 mx-auto my-3 border-light">
        <div th:if="${comentario.comentarioCitado() != null}" class="border-start ps-3 border-info border-4 bg-dark mb-3 py-2 px-3 rounded"> <!-- MODIFICACIÓN -->
            <div class="d-flex align-items-center">
                <small class="text-info">Cita de <b th:text="${comentario.comentarioCitado().usuario().nombreUsuario()}">Usuario</b></small>
                <a th:href="@{'/comentario/' + ${comentario.comentarioCitado().idComentarioPublicacion()}}" class="ms-2">
                    <i class="bi bi-reply-fill fs-6" style="transform: scaleX(-1); display: inline-block;"></i>
                </a>
            </div>
            <p class="text-white-50 m-0 pt-2" th:text="${comentario.comentarioCitado().contenido()}">Texto citado...</p>
        </div>
      <!--Contenido del tema-->
    <div class="my-3 mx-3">
    <p class="text-break" th:text="${comentario.contenido}" style="white-space: pre-wrap;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla egestas euismod lorem accumsan placerat. Sed molestie nulla et nisl convallis venenatis. Nam auctor eros enim, in aliquam nibh tincidunt sed. Sed nec efficitur sapien. Cras eget venenatis nisi. Mauris porta tortor nibh, sit amet condimentum quam semper in. Morbi eu leo pretium arcu pellentesque pellentesque. Integer id libero eget sapien pulvinar mollis. Cras ac tincidunt sapien, id tincidunt ligula. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam convallis bibendum neque, vel pellentesque ex ultrices in. Nullam nibh sem, volutpat at mi non, rhoncus egestas purus. Curabitur egestas, tellus quis consequat maximus, massa risus fermentum ante, quis cursus augue elit ac tortor.</p>
  </div>
  <!--Línea de separación-->
  <hr class="w-75 mx-auto my-3 border-light">
      <!--Botones de reportar, citar y responder-->
      <div class="mb-2 mt-2 d-flex gap-5 justify-content-center">
        <a class="nav-link"><i class="bi bi-exclamation-diamond fs-4"></i></a>
          <a class="nav-link citar-mensaje"
             href="#destino"
             th:data-id="${comentario.idComentarioPublicacion()}"
             th:data-autor="${comentario.usuario().nombreUsuario()}"
             th:data-contenido="${comentario.contenido}"
             th:data-link="@{/comentario/{id}(id=${comentario.idComentarioPublicacion()})}">
              <i class="bi bi-chat-dots-fill fs-4"></i> Citar
          </a>

          <a class="nav-link" href="#destino"><i class="bi bi-reply-fill fs-4"></i></a>
      </div>
  </div>

    <!--Caja de edición de texto de respuesta-->
    <div class="bg-dark text-light mt-3 mx-auto p-2 w-75" id="destino">
      <h4>Responder</h4>
    </div>
    <div class="bg-custom mx-auto p-4 w-75 mb-5" style="border-bottom-left-radius: 1rem; border-bottom-right-radius: 1rem;">
        <!--Iconos de edición de texto-->
      <div class="d-flex justify-content-center">
        <div class="d-flex">
        <a class="nav-link"><i class="bi bi-type-bold fs-2"></i></a>
        <a class="nav-link"><i class="bi bi-type-italic fs-2"></i></a>
        <a class="nav-link"><i class="bi bi-type-underline fs-2"></i></a>
      </div>
      <div class="d-flex ms-4">
        <a class="nav-link"><i class="bi bi-text-left fs-2"></i></a>
        <a class="nav-link"><i class="bi bi-text-center fs-2"></i></a>
        <a class="nav-link"><i class="bi bi-text-right fs-2"></i></a>
      </div>
      <div class="d-flex ms-5">
        <a class="nav-link"><i class="bi bi-list-ol fs-2"></i></a>
      </div>
      <div class="d-flex ms-5">
        <a class="nav-link"><i class="bi bi-list-ul fs-2"></i></a>
      </div>
      <div class="d-flex ms-5">
        <a class="nav-link"><i class="bi bi-card-image fs-2"></i></a>
      </div>
      </div>
        <!--Caja de contenido de la respuesta-->
        <form th:action="@{/comunidades/{idcom}/temas/{id}(idcom=${comunidad.idComunidad()}, id=${comentarios.get(0).publicacion().idPublicacion()})}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="mt-2">

            <div id="mensaje-citado-preview"
                 class="mensaje-citado px-3 py-2 [[${comentarioCitado} != null ? '' : 'd-none']]" th:if="${comentarioCitado != null}"> <!-- MODIFICACIÓN -->

            <div class="d-flex align-items-center">
                <h6 class="m-0 mb-1">
                    Cita de <b id="nombre-autor-cita" th:text="${comentarioCitado.usuario.nombreUsuario}">Usuario</b>
                </h6>
                <a th:href="@{'/comentario/' + ${comentarioCitado.idComentarioPublicacion}}" class="ir-a-mensaje-citado ms-2" id="link-mensaje-citado">
                    <i class="bi bi-reply-fill fs-4" style="transform: scaleX(-1); display: inline-block;"></i>
                </a>
            </div>
            <p class="m-0 pt-2" id="contenido-cita" th:text="${comentarioCitado.contenido}">Contenido...</p>
        </div>


            <!-- Campo oculto con el ID del comentario citado -->
            <input type="hidden" name="comentarioCitadoId" id="mensajeCitadoId"
                   th:value="${comentarioCitado != null} ? ${comentarioCitado.idComentarioPublicacion} : ''" />

            <!-- MODIFICACIÓN -->


            <textarea id="contenido-tema" name="contenido" class="form-control" rows="5" placeholder="Escribe aquí tu respuesta" required></textarea>

      </div>
      <!--Advertencia y Botón Enviar Respuesta-->
      <div class="mt-4 d-flex justify-content-between align-items-center">
        <p class="mb-0 w-75 opacity-50" style="font-size: 10px;">
          Te informamos que eres responsable del contenido ilícito que publiques.
          El contenido que publiques puede incumplir nuestras condiciones generales de uso o suponer una infracción del ordenamiento jurídico.
          Te recomendamos visitar nuestras <a href="#" class="condiciones">condiciones generales de uso</a> para conocer qué tipo de contenido no puedes publicar.
        </p>
        <button type="submit" class="btn btn-outline-light text-white">Enviar respuesta</button>
      </div>
        </form>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".citar-mensaje").forEach(btn => {
            btn.addEventListener("click", function (e) {
                e.preventDefault();

                const autor = this.dataset.autor;
                const contenido = this.dataset.contenido;
                const id = this.dataset.id;
                const link = this.dataset.link;

                document.getElementById("nombre-autor-cita").innerText = autor;
                document.getElementById("contenido-cita").innerText = contenido;
                document.getElementById("mensajeCitadoId").value = id;
                document.getElementById("link-mensaje-citado").href = link;

                document.getElementById("mensaje-citado-preview").classList.remove("d-none");

                // Scroll al formulario
                const destino = document.getElementById("destino");
                destino.scrollIntoView({ behavior: "smooth" });
            });
        });
    });
</script>
  </body>
</html>